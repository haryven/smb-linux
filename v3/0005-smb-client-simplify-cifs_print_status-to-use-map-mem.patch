From 3d21ee6383025b491eaf87b776b522155c37940f Mon Sep 17 00:00:00 2001
From: Huiwen He <hehuiwen@kylinos.cn>
Date: Thu, 22 Jan 2026 17:27:24 +0800
Subject: [PATCH 5/9] smb/client: simplify cifs_print_status to use map members

Signed-off-by: Huiwen He <hehuiwen@kylinos.cn>
---
 fs/smb/client/smb1maperror.c | 13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

diff --git a/fs/smb/client/smb1maperror.c b/fs/smb/client/smb1maperror.c
index eb8e90d2d285..04b5c93b513a 100644
--- a/fs/smb/client/smb1maperror.c
+++ b/fs/smb/client/smb1maperror.c
@@ -675,13 +675,11 @@ ntstatus_to_dos(__u32 ntstatus)
  Print an error message from the status code
  *****************************************************************************/
 static void
-cifs_print_status(__u32 status_code)
+cifs_print_status(const struct nt_err_code_struct *map)
 {
-	const struct nt_err_code_struct *map = ntstatus_to_dos(status_code);
-
 	if (map)
 		pr_notice("Status code returned 0x%08x %s\n",
-			  status_code, map->nt_errstr);
+			  map->ntstatus, map->nt_errstr);
 }
 
 int
@@ -703,14 +701,13 @@ map_smb_to_linux_error(char *buf, bool logErr)
 		/* translate the newer STATUS codes to old style SMB errors
 		 * and then to POSIX errors */
 		__u32 err = le32_to_cpu(smb->Status.CifsError);
-		const struct nt_err_code_struct *map;
+		const struct nt_err_code_struct *map = ntstatus_to_dos(err);
 
 		if (logErr && (err != (NT_STATUS_MORE_PROCESSING_REQUIRED)))
-			cifs_print_status(err);
+			cifs_print_status(map);
 		else if (cifsFYI & CIFS_RC)
-			cifs_print_status(err);
+			cifs_print_status(map);
 
-		map = ntstatus_to_dos(err);
 		if (map) {
 			smberrclass = map->dos_class;
 			smberrcode = map->dos_code;
-- 
2.43.0

